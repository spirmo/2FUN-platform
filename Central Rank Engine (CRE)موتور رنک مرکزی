[USER] 
  - شناسه کاربر (user_id)
  - user_code (17 رقمی)
  - رنک کاربر
  - کلونی مبدأ
  - وضعیت عضویت فعال/غیرفعال

[COLONY]
  - شناسه کلونی (colony_id)
  - نام کلونی
  - لیدر (Leader)
  - معاون اول (Deputy1)
  - معاون دوم (Deputy2)
  - اعضا (Members)
  - رنک کلونی، امتیاز، ستاره‌ها

[USER_COLONIES]
  - user_id
  - colony_id
  - active (فعال/غیرفعال)
  - joined_at
  - leave_attempts
  - last_activity
  - membership_type: (مبدأ، تخصصی، عمومی)

[EVENTS_TABLE] 
  - ثبت همه فعالیت‌ها و مأموریت‌ها
  - event_type: activity / positive / negative / mission
  - event_value
  - related_user_id (لیدری که رأی داده یا فعالیت را کنترل کرده)
  - timestamp

[LEDGER]
  - محاسبه رنک کاربر و کلونی
  - ثبت افزایش یا کاهش رنک
  - ذخیره تاریخچه تغییرات برای audit

[NEGATIVE_HISTORY]
  - user_id
  - colony_id
  - cycle_number (1 تا 3)
  - votes (رای‌های منفی ارکان)
  - last_negative_at
  - is_cleared
  - کاهش رنک کاربر و کلونی مبدأ و کلونی دریافت‌کننده منفی (سیستم فقط به صورت پشت صحنه اعمال می‌کند)

[EXPULSIONS]
  - user_id
  - colony_id
  - cycle_number
  - votes: leader_vote, deputy1_vote, deputy2_vote
  - completed_at
  - reentry_allowed_at
  - reentry_used
  - permanently_blocked
  - final_platform_expulsion

---

# جریان‌ها

1️⃣ عضویت کاربر در کلونی
   - کاربر توسط یک inviter به کلونی وارد می‌شود
   - اگر inviter لیدر نشده باشد → کلونی مبدأ = کلونی inviter
   - اگر inviter لیدر شده باشد → کلونی مبدأ = کلونی‌ای که inviter ایجاد کرده
   - user_colonies.active = TRUE

2️⃣ فعالیت و امتیازدهی
   - همه فعالیت‌ها ثبت می‌شوند (Events Table)
   - Rank Engine محاسبه می‌کند:
       - افزایش رنک مثبت
       - کاهش رنک منفی
   - کاهش رنک کاربر و کلونی مرتبط اعمال می‌شود

3️⃣ امتیاز منفی و اخطار
   - ثبت امتیاز منفی در negative_history
   - هر cycle شامل یک رأی منفی از هر رکن
   - بعد از ۳ cycle:
       - حق اخراج از کلونی مبدأ ایجاد می‌شود
       - کاهش رنک کاربر و کلونی‌ها مطابق قوانین

4️⃣ رأی‌گیری برای اخراج
   - هر cycle رأی‌گیری ۳ ارکان: Leader، Deputy1، Deputy2
   - ۲ از ۳ رأی برای اخراج قطعی لازم است
   - در صورت تصویب:
       - final_platform_expulsion = TRUE
       - user_colonies.active = FALSE
       - اخراج از پلتفرم ثبت می‌شود

5️⃣ بازگشت کاربر
   - اگر user_colonies.active = FALSE و عضو کلونی دیگری نباشد:
       - بازگشت خودکار به کلونی مبدأ
   - اگر reentry_allowed_at رسیده باشد و reentry_used = FALSE:
       - با رأی ارکان مجدداً فعال می‌شود
       - Ledger ثبت return event

6️⃣ محدودیت‌ها و پاکسازی
   - کاربر برای هر کلونی تخصصی یا عمومی:
       - حق ورود دوبار با تأیید ارکان
       - ورود سوم با تأیید ۳ رکن
   - امتیاز منفی در یک سال بدون دریافت منفی دیگر → پاکسازی خودکار
   - حداقل زمان قابل برگشت به کلونی اخراج شده: ۳۰ روز

7️⃣ سلسله مراتب نمایش کد
   - لیدر: مشاهده user_code کامل
   - معاون اول: مشاهده کد شخصی + شهر + شهرستان + استان (کد کشور مخفی)
   - معاون دوم: مشاهده کد شخصی + شهر + شهرستان (کد استان و کشور مخفی)
   - اعضا: مشاهده کد شخصی + شهر

8️⃣ عضویت و جابجایی
   - همه اعضا می‌توانند افراد جدید را وارد کنند
   - سلسله مراتب از کاربر معمولی → ۵ ستاره → معاون دوم → معاون اول
   - جابجایی بین کلونی‌ها محدود به دو بار برای هر کلونی، بار سوم نیاز به رأی ۳ ارکان

9️⃣ اثر امتیاز منفی روی رنک‌ها
   - هر امتیاز منفی → کاهش رنک کاربر و کلونی مبدأ + کلونی که منفی دریافت کرده
   - کاربر فقط کاهش رنک خود را می‌فهمد، مقدار دقیق کاهش برای او مخفی است

10️⃣ مدیریت خودکار و مقیاس‌پذیری
    - Ledger و Events Table باعث محاسبه سبک و سریع رنک حتی برای میلیون‌ها کاربر می‌شود
    - Jobهای روزانه برای پاکسازی منفی و بروزرسانی فعالیت‌ها اجرا می‌شوند

---
